<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script>

google.charts.load('current', {packages: ['corechart', 'bar']});
google.charts.setOnLoadCallback(init);

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  while (0 !== currentIndex) {

    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}
function test(flag){
    if(!flag) {

        setTimeout(function() {

           alert();
           test(true);

        }, 5000);
        return;
    }
}

_first=[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];
array = shuffle(_first);
length = array.length;

var data, chart, options;
var inp, out;

function isSorted() {
  var last_x = -Infinity;
  for (x in array) {
    if (last_x > array[x]) {
      return false;
    }
    last_x = array[x];
  }
  return true;
}

function init() {
  inp = document.getElementById("inp");
  out = document.getElementById("output");

  inp.value = getCookie("last");

  out.scrollTop = out.scrollHeight;

  data = new google.visualization.DataTable();
  chart = new google.charts.Bar(document.getElementById('chart_div'));
  data.addColumn('number', 'Index');
  data.addColumn('number', 'Val');
  options = {
    animation: {
      startup: true,      
      duration: 1000,
      easing: 'out'
    },
    legend: {
      position: 'none'
    }
  };
  draw();
}
function updateArray() {
  data.removeRows(0, data.Tf.length);
  var ci = 0;
  for (r in array) {
    data.addRow([ci++, array[r]]);
  }
}

function runScript(e) {
  console.log(e);
    if ((e.keyCode == 10 || e.keyCode == 13) && (e.ctrlKey || e.metaKey)) {
        update();
        e.preventDefault();
        return false;
    }
}
function draw() {
    updateArray();
    chart.draw(data, options);
}

function swap(a, b) {
  if (a < 0 || b < 0) {
    err("Swapping must have positive indexes!");
    return;
  } else if (a >= array.length || b >= array.length) {
    err("One of the indexes is above the max length, " + array.length);
    return;
  }
  var tmp = array[a];
  array[a] = array[b];
  array[b] = tmp;
  //draw();
}

function update() {
  out.value = "";
  createCookie("last", inp.value);
  eval(inp.value);
  draw();
}
function reset() {
  out.value = "";
  array = shuffle(_first);
  draw();
}
function err(text) {
  out.value = out.value + "ERROR: " + text + "\n";
}
function write(text) {
  out.value = out.value + text + "\n";
}

var example_code = ["/* \n\
 \n\
 Sort[101] Example Code: Bubble sort \n\
 \n\
  Author: Cade Brown \n\
 \n\
  While the array is not sorted, the code loops, and if two items need to be switched, they are. \n\
 \n\
  Runtime: O(n^2) for most random arrangements, but runs in O(n) for sorted list (just verified by isSorted()). \n\
 \n\
  Run space: O(n). There is a temporary variable used by our method swap(), which is \n\
 \n\
*/ \n\
 \n\
while (!isSorted()) { \n\
  for (i = 0; i < length-1; i++) { \n\
    if (array[i] > array[i+1]) { \n\
      swap(i, i+1); \n\
    } \n\
  } \n\
}"]


function changeExample(thing) {
    inp.value = example_code[parseInt(thing.value)];
}

var createCookie = function(name, value) {
    value = value.replace(/(?:\r\n|\r|\n)/g, '__n_no_var');
    value = value.replace(/(?:\;)/g, '__s_no_var');
    console.log(value)
    document.cookie = name + "=" + value + ";";
}

function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = document.cookie.length;
            }
            return unescape(document.cookie.substring(c_start, c_end)).replace(/__n_no_var/g, "\n").replace(/__s_no_var/g, ";");
        }
    }
    return "";
}
</script>
