
{% include google-charts.html %}

<script>

google.charts.setOnLoadCallback(init);


function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  while (0 !== currentIndex) {

    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}
function test(flag){
    if(!flag) {

        setTimeout(function() {

           alert();
           test(true);

        }, 5000);
        return;
    }
}


var inp, out;
var lo_lim, hi_lim, _num;

function isSorted() {
  var last_x = -Infinity;
  for (x in array) {
    if (last_x > array[x]) {
      return false;
    }
    last_x = array[x];
  }
  return true;
}


function init() {
  getDefaults();
  updateSettings();

  inp = document.getElementById("inp");
  out = document.getElementById("output");

  inp.value = getCookie("last");

  out.scrollTop = out.scrollHeight;

  chart_init();
 
  resetArray();
  
  draw();
}

vals = ["hi_lim", "lo_lim", "_num"];

function updateSettings() {
  for (val in vals) {
    eval(vals[val] + " = parseInt(" + $("#" + vals[val]).val() + ")");
    createCookie(vals[val], $("#" + vals[val]).val())
  }
}

function getDefaults() {
  for (val in vals) {
    if (getCookie(vals[val])) {
      $("#" + vals[val]).val(getCookie(vals[val]));
    }
  }
}

function runScript(e) {
  if ((e.keyCode == 10 || e.keyCode == 13) && (e.ctrlKey || e.metaKey)) {
    update();
    e.preventDefault();
    return false;
  }
}

function swap(a, b) {
  if (a < 0 || b < 0) {
    err("Swapping must have positive indexes!");
    return;
  } else if (a >= array.length || b >= array.length) {
    err("One of the indexes is above the max length, " + array.length);
    return;
  }
  var tmp = array[a];
  array[a] = array[b];
  array[b] = tmp;
  //update();
  draw();
}
function resetArray() {
  _first=[];
  for (_i = 0; _i < _num; ++_i) _first.push(Math.random() * (1 + hi_lim - lo_lim) + lo_lim);
  array = shuffle(_first);
  length = array.length;
  updateArray();
}

function update() {
  updateSettings();
  //resetArray();
  
  out.value = "";
  createCookie("last", inp.value);
  var tnow, tend;
  tnow = performance.now();
  eval(inp.value);
  tend = performance.now();
  write("Took: " + (tend - tnow) + "ms");
  write("Is sorted: " + isSorted());
  draw();
}
function reset() {
  updateSettings();
  resetArray();

  out.value = "";
  array = shuffle(_first);
  draw();
}
function err(text) {
  out.value = out.value + "ERROR: " + text + "\n";
}
function write(text) {
  out.value = out.value + text + "\n";
}

var example_code = ["/* \n\
 \n\
 Sort[101] Example Code: Bubble sort \n\
 \n\
 Time complexity: O(n^2), space complexity: O(n) \n\
 \n\
*/ \n\
 \n\
while (!isSorted()) { \n\
  for (i = 0; i < length-1; i++) { \n\
    if (array[i] > array[i+1]) { \n\
      swap(i, i+1); \n\
    } \n\
  } \n\
}"]


function changeExample(thing) {
    inp.value = example_code[parseInt(thing.value)];
}

var createCookie = function(name, value) {
    value = value.replace(/(?:\r\n|\r|\n)/g, '__n_no_var');
    value = value.replace(/(?:\;)/g, '__s_no_var');
    console.log(value)
    document.cookie = name + "=" + value + ";";
}

function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = document.cookie.length;
            }
            return unescape(document.cookie.substring(c_start, c_end)).replace(/__n_no_var/g, "\n").replace(/__s_no_var/g, ";");
        }
    }
    return "";
}
</script>
